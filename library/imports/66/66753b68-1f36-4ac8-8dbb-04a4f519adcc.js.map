{"version":3,"sources":["../../../../assets/Script/assets/Script/Player.ts"],"names":[],"mappings":";;;;;AAAM,IAAA,kBAAqC,EAAnC,oBAAO,EAAE,sBAAQ,CAAkB;AAI3C;IAAoC,0BAAY;IADhD;QAAA,qEA4IC;QA1IC,UAAU;QAEV,kBAAY,GAAW,CAAC,CAAA;QAExB,QAAQ;QAER,gBAAU,GAAW,CAAC,CAAA;QAEtB,WAAW;QAEX,oBAAc,GAAW,CAAC,CAAA;QAE1B,MAAM;QAEN,WAAK,GAAW,CAAC,CAAA;QAEjB,QAAQ;QAER,kBAAY,GAAW,CAAC,CAAA;QAExB,OAAO;QACP,aAAO,GAAG,KAAK,CAAA;QAEf,OAAO;QACP,cAAQ,GAAG,KAAK,CAAA;QAEhB,iBAAiB;QACjB,UAAI,GAAG,IAAI,CAAA;QAEX,YAAM,GAAG,CAAC,CAAA;QACV,aAAO,GAAG,IAAI,CAAA;QACd,WAAK,GAAG,CAAC,CAAA,CAAC,UAAU;;IA2GtB,CAAC;IAzGC,8BAAa,GAAb;QACE,IAAI,CAAC,OAAO,GAAG,KAAK,CAAA;QACpB,IAAM,UAAU,GAAG,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,UAAU,CAAA;QAC5D,OAAO;QACP,IAAI,MAAM,GAAG,EAAE;aACZ,MAAM,CAAC,IAAI,CAAC,YAAY,EAAE,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,UAAU,CAAC,CAAC;aAC/C,MAAM,CAAC,EAAE,CAAC,kBAAkB,EAAE,CAAC,CAAA;QAClC,KAAK;QACL,IAAI,QAAQ,GAAG,EAAE;aACd,MAAM,CAAC,IAAI,CAAC,YAAY,EAAE,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,UAAU,CAAC,CAAC;aAChD,MAAM,CAAC,EAAE,CAAC,iBAAiB,EAAE,CAAC,CAAA;QACjC,KAAK;QACL,IAAM,MAAM,GAAG,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,cAAc,EAAE,CAAC,EAAE,GAAG,CAAC,CAAA;QACtD,IAAM,OAAO,GAAG,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,cAAc,EAAE,CAAC,EAAE,GAAG,CAAC,CAAA;QACvD,IAAM,SAAS,GAAG,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,cAAc,EAAE,CAAC,EAAE,CAAC,CAAC,CAAA;QACvD,4BAA4B;QAC5B,IAAM,WAAW,GAAG,EAAE,CAAC,QAAQ,CAAC,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,CAAA;QACvD,IAAM,IAAI,GAAG,EAAE,CAAC,QAAQ,CACtB,MAAM,EACN,OAAO,EACP,MAAM,EACN,SAAS,EACT,QAAQ,EACR,WAAW,CACZ,CAAA;QACD,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAA;IAC3B,CAAC;IAED,4BAAW,GAAX;QACE,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAA;QAClB,IAAI,CAAC,OAAO,GAAG,IAAI,CAAA;QACnB,IAAI,CAAC,MAAM,GAAG,CAAC,CAAA;IACjB,CAAC;IACD,OAAO;IACP,0BAAS,GAAT,UAAU,KAAU;QAClB,IAAI,IAAI,CAAC,OAAO,EAAE;YAChB,IAAI,CAAC,aAAa,EAAE,CAAA;YACpB,8BAA8B;YAC9B,QAAQ,KAAK,CAAC,OAAO,EAAE;gBACrB,KAAK,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;oBACjB,IAAI,CAAC,OAAO,GAAG,IAAI,CAAA;oBACnB,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAA;oBACrB,MAAK;gBACP,KAAK,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;oBACjB,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAA;oBACpB,IAAI,CAAC,OAAO,GAAG,KAAK,CAAA;oBACpB,MAAK;aACR;SACF;IACH,CAAC;IAED,OAAO;IACP,wBAAO,GAAP,UAAQ,KAAU;QAChB,IAAI,IAAI,CAAC,OAAO,EAAE;YAChB,QAAQ,KAAK,CAAC,OAAO,EAAE;gBACrB,KAAK,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;oBACjB,IAAI,CAAC,OAAO,GAAG,KAAK,CAAA;oBACpB,MAAK;gBACP,KAAK,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;oBACjB,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAA;oBACrB,MAAK;aACR;SACF;IACH,CAAC;IAED,sBAAK,GAAL;QACE,cAAc;QACd,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC,CAAA;QAExB,EAAE,CAAC,WAAW,CAAC,EAAE,CAAC,EAAE,CAAC,WAAW,CAAC,SAAS,CAAC,QAAQ,EAAE,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,CAAA;QAC1E,EAAE,CAAC,WAAW,CAAC,EAAE,CAAC,EAAE,CAAC,WAAW,CAAC,SAAS,CAAC,MAAM,EAAE,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,CAAA;QAEtE,eAAe;QACf,IAAI,CAAC,IAAI,GAAG,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAA;IAC/B,CAAC;IAED,uBAAM,GAAN,UAAO,EAAU;QACf,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;YACjB,IAAI,IAAI,CAAC,OAAO,EAAE;gBAChB,oBAAoB;gBACpB,IAAI,CAAC,MAAM,IAAI,IAAI,CAAC,KAAK,GAAG,EAAE,CAAA;aAC/B;YAED,IAAI,IAAI,CAAC,QAAQ,EAAE;gBACjB,IAAI,CAAC,MAAM,IAAI,IAAI,CAAC,KAAK,GAAG,EAAE,CAAA;aAC/B;YAED,iBAAiB;YACjB,IAAI,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,GAAG,IAAI,CAAC,YAAY,EAAE;gBAC7C,6DAA6D;gBAC7D,IAAI,CAAC,MAAM,GAAG,CAAC,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,CAAA;aACxE;YAED,gBAAgB;YAChB,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,IAAI,CAAC,MAAM,GAAG,EAAE,CAAA;YAE/B,IAAI,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,GAAG,CAAC,EAAE;gBAC5C,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,GAAG,CAAC,CAAA;gBACxC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAA;aAChB;iBAAM,IAAI,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,GAAG,CAAC,EAAE;gBACpD,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,GAAG,CAAC,CAAA;gBACzC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAA;aAChB;SACF;IACH,CAAC;IAvID;QADC,QAAQ;gDACe;IAIxB;QADC,QAAQ;8CACa;IAItB;QADC,QAAQ;kDACiB;IAI1B;QADC,QAAQ;yCACQ;IAIjB;QADC,QAAQ;gDACe;IAnBL,MAAM;QAD1B,OAAO;OACa,MAAM,CA2I1B;IAAD,aAAC;CA3ID,AA2IC,CA3ImC,EAAE,CAAC,SAAS,GA2I/C;kBA3IoB,MAAM","file":"","sourceRoot":"../../../../assets/Script","sourcesContent":["const { ccclass, property } = cc._decorator\nimport ShootControl from './ShootControl'\n\n@ccclass\nexport default class Player extends cc.Component {\n  // 跳跃的时间间隔\n  @property\n  jumpDuration: number = 0\n\n  // 跳跃的高度\n  @property\n  jumpHeight: number = 0\n\n  // 辅助形变动作时间\n  @property\n  squashDuration: number = 0\n\n  // 加速度\n  @property\n  accel: number = 0\n\n  // 最大加速度\n  @property\n  maxMoveSpeed: number = 0\n\n  // 向右移动\n  accLeft = false\n\n  // 向左移动\n  accRight = false\n\n  // 获取到父节点Canvas对象\n  game = null\n  shootControl: ShootControl\n  xSpeed = 0\n  canJump = true\n  initY = 0 // 获取初始化高度\n\n  setJumpAction() {\n    this.canJump = false\n    const jumpHeight = (Math.random() + 1) * 2 * this.jumpHeight\n    // 跳跃上升\n    var jumpUp = cc\n      .moveBy(this.jumpDuration, cc.v2(0, jumpHeight))\n      .easing(cc.easeCubicActionOut())\n    // 下落\n    var jumpDown = cc\n      .moveBy(this.jumpDuration, cc.v2(0, -jumpHeight))\n      .easing(cc.easeCubicActionIn())\n    // 形变\n    const squash = cc.scaleTo(this.squashDuration, 1, 0.6)\n    const stretch = cc.scaleTo(this.squashDuration, 1, 1.1)\n    const scaleBack = cc.scaleTo(this.squashDuration, 1, 1)\n    // 不断重复，而且每次完成落地动作后调用回调来播放声音\n    const callbackFun = cc.callFunc(this.callbackFun, this)\n    const sequ = cc.sequence(\n      squash,\n      stretch,\n      jumpUp,\n      scaleBack,\n      jumpDown,\n      callbackFun\n    )\n    this.node.runAction(sequ)\n  }\n\n  callbackFun() {\n    console.log('进来了')\n    this.canJump = true\n    this.xSpeed = 0\n  }\n  // 按下键盘\n  onKeyDown(event: any) {\n    if (this.canJump) {\n      this.setJumpAction()\n      // set a flag when key pressed\n      switch (event.keyCode) {\n        case cc.macro.KEY.a:\n          this.accLeft = true\n          this.accRight = false\n          break\n        case cc.macro.KEY.d:\n          this.accRight = true\n          this.accLeft = false\n          break\n      }\n    }\n  }\n\n  // 释放键盘\n  onKeyUp(event: any) {\n    if (this.canJump) {\n      switch (event.keyCode) {\n        case cc.macro.KEY.a:\n          this.accLeft = false\n          break\n        case cc.macro.KEY.d:\n          this.accRight = false\n          break\n      }\n    }\n  }\n\n  start() {\n    // 获取初始化物体的y坐标\n    this.initY = this.node.y\n\n    cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this)\n    cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this)\n\n    // 获取到父组件Canvas\n    this.game = cc.find('Canvas')\n  }\n\n  update(dt: number) {\n    if (!this.canJump) {\n      if (this.accLeft) {\n        // this.node.x -= 10\n        this.xSpeed -= this.accel * dt\n      }\n\n      if (this.accRight) {\n        this.xSpeed += this.accel * dt\n      }\n\n      // 限制主角的速度不能超过最大值\n      if (Math.abs(this.xSpeed) > this.maxMoveSpeed) {\n        // if speed reach limit, use max speed with current direction\n        this.xSpeed = (this.maxMoveSpeed * this.xSpeed) / Math.abs(this.xSpeed)\n      }\n\n      // 根据当前速度更新主角的位置\n      this.node.x += this.xSpeed * dt\n\n      if (this.node.x > this.node.parent.width / 2) {\n        this.node.x = this.node.parent.width / 2\n        this.xSpeed = 0\n      } else if (this.node.x < -this.node.parent.width / 2) {\n        this.node.x = -this.node.parent.width / 2\n        this.xSpeed = 0\n      }\n    }\n  }\n}\n"]}